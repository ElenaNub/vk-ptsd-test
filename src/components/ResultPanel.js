import React from 'react';
import {
  Panel, PanelHeader, Div, Title, Text, Button
} from '@vkontakte/vkui';
import bridge from '@vkontakte/vk-bridge';
/* простая интерпретация + советы */
const interp = (score) => {
  if (score <= 19) return {
    label: 'Симптомы минимальны',
    detail: `Вы в пределах нормы. Сохраняйте режим сна и умеренную активность.
    Вы способны к естественному и здоровому восстановлению после стресса. Эпизодические воспоминания, тревога или краткосрочные нарушения сна могут возникнуть, но не мешают повседневной жизни.
    
    Советы для поддержания устойчивости:

    Постарайтесь ложиться спать в одно и тоже время,  спите 7-8 часов. Проветривайте помещение перед сном. 
Занимайтесь физической активностью: быстрая ходьба, плавание, йога ≥ 150 мин/нед.
Дневник настроения : отмечайте, что вызывает всплески раздражения.
Социальная опора: общайтесь с близкими друзьями, делитесь переживаниями, если это Вам необходимо.

Помните - невозможно полностью избежать стресса, главное - эффективно с ним справляться!`
  };
  if (score <= 39) return {
    label: 'Зона риска',
    detail: `Вы находитесь в зоне риска развития посттравматического стрессового расстройства: симптомы уже развиваются, но пока серьезно не мешают повседневной жизни.
     Возможно, в недавнем времени Вы пережили сильный стресс и еще не восстановились от него. Если оставить всё как есть, состояние может ухудшиться.

     Советы на ближайшие 4–6 недель ⏳:

     Стабилизируйте сон : старайтесь ложиться и просыпаться в одно и тоже время, соблюдайте гигиену сна - избегайте кофеина и гаджетов за 60 минут до сна.
     
     Дыхательные практики : Вы можете использовать технику глубокого расслабления "Дыхание 4-7-8".  
     Практика заключается во вдохе на счёт четыре, задержку дыхания на счёт семь и выдох на счёт восемь. Занимайтесь 10 минут в день, можете повторять несколько раз,
      пока не почувствуете успокоение.
     
     Дневник триггеров : фиксируйте ситуации, места или события, вызывающие негативные переживания. Ищите повторяющиеся триггеры, отмечайте интенсивность переживаемых эмоций.
     Для каждого триггера необходимо придумать способы, как можно его избежать или снизить его влияние. Постепенно нужно пробовать применять выбранные стратегии в реальной жизни.
     
     Дозируйте информационный поток : отключите пуш-уведомления новостных лент. Выберите несколько качественных инсточников информации, которым доверяете. 
     Это поможет отсеять ненужный шум и сосредоточиться на действительно важной информации.
     Выделите конкретное «окно», к примеру, 20 минут в день на просмотр новостной ленты.
     
     Психопросвет: ознакомьтесь с коротким онлайн-курсом о стресс-менеджменте или прочтите лекцию ВОЗ «Самопомощь».
     
     Если через месяц баллы не снижаются, тревога возрастает и мешает работе — запланируйте разговор с психологом.`
  };
  if (score <= 59) return {
    label: 'Вероятный ПТСР',
    detail: `У Вас есть признаки клинического посттравматического стрессового расстройства. Вы отмечаете частые тревожные воспоминания, 
    стараетесь избегать того, что напоминает о пережитом, плохо спите и всё время живёте «на взводе». Стоит обратиться к травма-терапевту/КПТ-специалисту, выработать план помощи.
    
    Рекомендации:

    1. Сходите к врачу-психиатру
Это не «для психов», а обычный медицинский визит, как к кардиологу. Врач оценит ваши симптомы и, если нужно, подберёт мягкие антидепрессанты или таблетки для сна. 
Лекарства не «делают овощем» — они снижают фон тревоги, чтобы вам было проще работать со своими чувствами.

2. Начните регулярную психотерапию
Лучше всего подходят разговорные методы, которые фокусируются на травме: когнитивно-поведенительная терапия или 
метод «переработки травматичных воспоминаний движением глаз». На практике это 8–12 встреч раз в неделю. 
Уже после первых двух-трёх сеансов вы получите техники, как быстро «заземляться», когда накатывает всплеск тревоги.

3. Составьте «план безопасности»
Запишите на листке:
 - три вещи, которые быстро успокаивают вас (например: холодная вода на запястья, дыхание 4–7–8, звонок другу);
 - людей, которым можно позвонить днём и вечером;
 - шаги «что я делаю, если мне очень плохо» (например: выйти на улицу, позвонить в скорую, попросить соседа о помощи).
Держите этот лист рядом с кроватью или прикрепите на холодильник.

4. Стабилизируйте сон
Старайтесь ложиться и просыпаться в одно и тоже время, соблюдайте гигиену сна - избегайте кофеина и гаджетов за 60 минут до сна. 
Проветривайте помещение перед сном, спите в полной темноте (если у Вас нет страха темноты) - это поможет улучшить качество сна и Ваше самочувствие днем.

5.Движение и физические нагрузки
 Не изматывайте себя, достаточно 20 минут быстрой ходьбы, йоги или плавания утром или вечером.

6.Питание
Три основных приёма пищи без долгих голодовок и ночных перекусов.
Нашему мозгу важно знать, что «день предсказуем» — так тревога снижается сама.

7. Ограничьте стимуляторы
Кофе после обеда, энергетики, алкоголь и частые новости усиливают тревожность. 
Попробуйте хотя бы две недели без «допинга» и без бесконечной ленты новостей – обычно люди отмечают, что спят спокойнее и вспышек тревоги становится меньше.

Как понять, что идёте в верном направлении?
Через месяц снова пройдите опрос. Если баллов станет меньше хотя бы на 10, вы на правильном пути. Если нет — обсудите с врачом и терапевтом, что можно усилить или изменить.
Помните: пост-травматический стресс — это лечится. Главное — не оставаться с ним один на один и обращаться за помощью вовремя.`
  };
  return {
    label: 'Высокие симптомы ПТСР',
    detail: ` У Вас есть явные признаки клинического посттравматического стрессового расстройства.
    Ваше тело и психика сейчас живут в режиме постоянной тревоги. Плохой сон, навязчивые воспоминания, вспышки злости или отчаяния, ощущение, что «опасность где-то рядом» — всё это очень изматывает и мешает нормально жить.

    Рекомендации:

    1. Срочно поговорите с врачом-психиатром
    Это такой же специалист, как терапевт или кардиолог. Он выслушает вас, подберёт таблетки, которые:
    - уменьшат ночные кошмары и улучшат сон;
    - снизят уровень тревоги, чтобы день перестал ощущаться как «битва».
    Обычно это лёгкие антидепрессанты и, при необходимости, средство для сна. При правильном подборе побочки минимальны.
    
    2. Подключите еженедельную психотерапию
    Лучше всего подходят методы, где работают именно с травмой (например, когнитивно-поведенительная терапия для пост-травматического стресса или метод переработки травматичных воспоминаний движением глаз).
     На первых же встречах вы получите набор упражнений, которые помогают «вынырнуть», когда накрывает флешбэк или паника.
    
    3. Сделайте «кризисный набор на случай шторма»
    Лист безопасности:
    - техника быстрого успокоения (холодная вода, техника дыхания «4-4-4-4», счёт предметов вокруг);
    - номера экстренной помощи — 112 и круглосуточной линии доверия 8-800-2000-122;
    - контакты двух людей, которым можно позвонить днём и ночью.
    Безопасная среда: уберите из дома алкоголь и лишние таблетки, попросите близких не обсуждать тяжёлые новости при Вас.
    Держите этот лист на видном месте — например, на холодильнике.
    
    4. Верните в жизнь чёткий распорядок
    Сон: засыпайте и просыпайтесь в одно и то же время, спите не меньше 8 часов.
    Еда: три основных приёма пищи, без долгих перерывов и ночных перекусов.
    Движение: 20 минут быстрой ходьбы или растяжки утром и вечером.
    Предсказуемый ритм дня даёт мозгу сигнал: «Я в безопасности, можно расслабиться».
    
    5. Сократите всё, что «подливает масла»
    Крепкий кофе после обеда, энергетики, алкоголь, бесконечная лента новостей — всё это раскручивает тревогу. 
    Попробуйте две недели без стимуляторов и с «диетой новостей» (20 минут в день в чётко выбранное время). Обычно люди замечают, что спят лучше, а всплесков тревоги становится меньше.
    
    Как понять, что становится легче?
    Через три-четыре недели снова пройдите тест. Если баллов стало заметно меньше, вы движетесь в верном направлении. 
    Если улучшений нет или появляются мысли о самоповреждении — немедленно сообщите об этом врачу и близким. 
    Помните: сильные ПТСР лечатся, но не нужно бороться с ними в одиночку. Помощь специалистов и поддержка близких — ваш мост к спокойной, наполненной жизни.`
  };
};

export default function ResultPanel({ id, data, go }) {
  const { answers } = data;
  const score = answers.reduce((s, v) => s + v, 0);
  const { label, detail } = interp(score);

  return (
    <Panel id={id}>
      <PanelHeader>Результат</PanelHeader>
      <Div style={{ padding: 16 }}>
        <Title level="2">{score} баллов</Title>
        <Text weight="medium" style={{ marginTop: 8 }}>{label}</Text>
        <Text style={{ marginTop: 12, whiteSpace: 'pre-line' }}>{detail}</Text>

    <Div style={{ textAlign: 'center', marginTop: 24 }}>
  {/* 1. Кнопка «Пройти снова» */}
  <Button
    size="l"
    mode="primary"
    onClick={() => go({ type: 'restart' })}
  >
    Пройти снова
  </Button>

  {/* 2. Кнопка «Поддержать автора» через VK Donut */}
  <Button
    size="l"
    mode="commerce"
    style={{ marginTop: 12 }}
    onClick={() =>
      bridge.send('VKWebAppShowDonutSubscriptionBox', {
        group_id: 230504742,     // ← ваш ID группы
        suggested_price: 99      // ₽: 49 / 99 / 149 / 299
      })
    }
  >
    Поддержать автора&nbsp;(99&nbsp;₽)
  </Button>
</Div>

        </Div>
    
    </Panel>
  );
  
}
